{
    "version": 3,
    "terraform_version": "0.9.11",
    "serial": 16,
    "lineage": "45227979-1dd5-4098-9a12-be88291beecc",
    "modules": [
        {
            "path": [
                "root"
            ],
            "outputs": {},
            "resources": {
                "google_compute_firewall.default": {
                    "type": "google_compute_firewall",
                    "depends_on": [],
                    "primary": {
                        "id": "tf-www-firewall",
                        "attributes": {
                            "allow.#": "1",
                            "allow.272637744.ports.#": "1",
                            "allow.272637744.ports.0": "80",
                            "allow.272637744.protocol": "tcp",
                            "description": "",
                            "id": "tf-www-firewall",
                            "name": "tf-www-firewall",
                            "network": "default",
                            "project": "badgerodon-prod",
                            "self_link": "https://www.googleapis.com/compute/v1/projects/badgerodon-prod/global/firewalls/tf-www-firewall",
                            "source_ranges.#": "1",
                            "source_ranges.1080289494": "0.0.0.0/0",
                            "source_tags.#": "0",
                            "target_tags.#": "1",
                            "target_tags.1630882000": "www-node"
                        },
                        "meta": {
                            "schema_version": "1"
                        },
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "google_compute_instance_group_manager.consul_group_manager": {
                    "type": "google_compute_instance_group_manager",
                    "depends_on": [
                        "google_compute_instance_template.consul"
                    ],
                    "primary": {
                        "id": "consul-group",
                        "attributes": {
                            "base_instance_name": "consul",
                            "description": "",
                            "fingerprint": "yNXsTBkr31Q=",
                            "id": "consul-group",
                            "instance_group": "https://www.googleapis.com/compute/v1/projects/badgerodon-prod/zones/us-central1-a/instanceGroups/consul-group",
                            "instance_template": "https://www.googleapis.com/compute/v1/projects/badgerodon-prod/global/instanceTemplates/consul-00f61c26eaceef6d5cc82adcd2",
                            "name": "consul-group",
                            "named_port.#": "0",
                            "project": "badgerodon-prod",
                            "self_link": "https://www.googleapis.com/compute/v1/projects/badgerodon-prod/zones/us-central1-a/instanceGroupManagers/consul-group",
                            "target_pools.#": "0",
                            "target_size": "3",
                            "update_strategy": "RESTART",
                            "zone": "us-central1-a"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "google_compute_instance_group_manager.worker_group_manager": {
                    "type": "google_compute_instance_group_manager",
                    "depends_on": [
                        "google_compute_instance_template.worker"
                    ],
                    "primary": {
                        "id": "worker-group",
                        "attributes": {
                            "base_instance_name": "worker",
                            "description": "",
                            "fingerprint": "RnjNRJs5n7I=",
                            "id": "worker-group",
                            "instance_group": "https://www.googleapis.com/compute/v1/projects/badgerodon-prod/zones/us-central1-a/instanceGroups/worker-group",
                            "instance_template": "https://www.googleapis.com/compute/v1/projects/badgerodon-prod/global/instanceTemplates/consul-00f61c26eaceef6d5cc82adcd1",
                            "name": "worker-group",
                            "named_port.#": "0",
                            "project": "badgerodon-prod",
                            "self_link": "https://www.googleapis.com/compute/v1/projects/badgerodon-prod/zones/us-central1-a/instanceGroupManagers/worker-group",
                            "target_pools.#": "0",
                            "target_size": "1",
                            "update_strategy": "RESTART",
                            "zone": "us-central1-a"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "google_compute_instance_template.consul": {
                    "type": "google_compute_instance_template",
                    "depends_on": [],
                    "primary": {
                        "id": "consul-00f61c26eaceef6d5cc82adcd2",
                        "attributes": {
                            "automatic_restart": "true",
                            "can_ip_forward": "false",
                            "description": "",
                            "disk.#": "1",
                            "disk.0.auto_delete": "true",
                            "disk.0.boot": "true",
                            "disk.0.device_name": "",
                            "disk.0.disk_name": "",
                            "disk.0.disk_size_gb": "0",
                            "disk.0.disk_type": "pd-standard",
                            "disk.0.interface": "SCSI",
                            "disk.0.mode": "READ_WRITE",
                            "disk.0.source": "",
                            "disk.0.source_image": "ubuntu-os-cloud/ubuntu-1704",
                            "disk.0.type": "PERSISTENT",
                            "id": "consul-00f61c26eaceef6d5cc82adcd2",
                            "instance_description": "",
                            "machine_type": "f1-micro",
                            "metadata.%": "0",
                            "metadata_fingerprint": "OeJ7PgVvRb4=",
                            "metadata_startup_script": "#!/bin/bash\nset -x\nset -euo pipefail\nIFS=$'\\n\\t'\n#!/bin/bash\n\nif [[ $EUID -ne 0 ]]; then\n  echo \"This script must be run as root\"\n  exit 1\nfi\n\napt-get install -y \\\n    unzip \\\n    apt-transport-https \\\n    ca-certificates \\\n    curl \\\n    software-properties-common\n\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -\n\nsudo add-apt-repository -y \\\n   \"deb [arch=amd64] https://download.docker.com/linux/ubuntu \\\n   $(lsb_release -cs) \\\n   stable\"\n\nsudo apt-get update -y\nsudo apt-get install -y docker-ce\n\n# install docker-credential-gcr\ncurl -L https://github.com/GoogleCloudPlatform/docker-credential-gcr/releases/download/v1.4.1/docker-credential-gcr_linux_amd64-1.4.1.tar.gz | tar -xz -C /usr/local/bin\ndocker-credential-gcr configure-docker\n\n#!/bin/bash\n\nexport CONSUL_VERSION=0.8.5\n\necho \"[install] installing consul\"\ncd /tmp || exit\ncurl -O -L https://releases.hashicorp.com/consul/$CONSUL_VERSION/consul_${CONSUL_VERSION}_linux_amd64.zip\nunzip consul_${CONSUL_VERSION}_linux_amd64.zip\nmv consul /usr/bin/consul\nrm consul_${CONSUL_VERSION}_linux_amd64.zip\n\ncat \u003c\u003cEOF \u003e /etc/systemd/system/consul.service\n[Unit]\nDescription=consul\n[Service]\nExecStart=/usr/bin/consul agent -server \\\n  -data-dir=\"/tmp/consul\" \\\n  -bootstrap-expect 3 \\\n  -bind=\"$(ip -o -4 addr show | grep -v docker | grep global | awk -F '[ /]+' '{print $4}')\" \\\n  -retry-join-gce-tag-value consul\nRestart=always\n[Install]\nWantedBy=multi-user.target\nEOF\n\necho \"[install] starting consul\"\nsystemctl daemon-reload\nsystemctl enable consul\nsystemctl start consul\n\ncat \u003c\u003cEOF \u003e /etc/dhcp/dhclient.conf\nprepend domain-name-servers 127.0.0.1;\nEOF\n\n#!/bin/bash\n\nexport NOMAD_VERSION=0.5.6\n\necho \"[install] installing nomad\"\ncd /tmp || exit\ncurl -O -L https://releases.hashicorp.com/nomad/${NOMAD_VERSION}/nomad_${NOMAD_VERSION}_linux_amd64.zip\nunzip nomad_${NOMAD_VERSION}_linux_amd64.zip\nmv nomad /usr/bin/nomad\nrm nomad_${NOMAD_VERSION}_linux_amd64.zip\n\nmkdir -p /etc/nomad\nmkdir -p /var/lib/nomad\ncat \u003c\u003cEOF \u003e /etc/nomad/server.hcl\ndata_dir  = \"/var/lib/nomad\"\nserver {\n  enabled          = true\n  bootstrap_expect = 3\n}\nEOF\n\ncat \u003c\u003cEOF \u003e /etc/systemd/system/nomad.service\n[Unit]\nDescription=Nomad\nDocumentation=https://nomadproject.io/docs/\n[Service]\nExecStart=/usr/bin/nomad agent -config /etc/nomad\nExecReload=/bin/kill -HUP \\$MAINPID\nLimitNOFILE=65536\n[Install]\nWantedBy=multi-user.target\nEOF\n\necho \"[install] starting nomad\"\nsystemctl daemon-reload\nsystemctl enable nomad\nsystemctl start nomad\n\n  ",
                            "name": "consul-00f61c26eaceef6d5cc82adcd2",
                            "name_prefix": "consul-",
                            "network_interface.#": "1",
                            "network_interface.0.access_config.#": "1",
                            "network_interface.0.access_config.0.nat_ip": "",
                            "network_interface.0.network": "default",
                            "network_interface.0.network_ip": "",
                            "network_interface.0.subnetwork": "",
                            "network_interface.0.subnetwork_project": "",
                            "project": "badgerodon-prod",
                            "region": "us-central1",
                            "scheduling.#": "1",
                            "scheduling.0.automatic_restart": "true",
                            "scheduling.0.on_host_maintenance": "MIGRATE",
                            "scheduling.0.preemptible": "false",
                            "self_link": "https://www.googleapis.com/compute/v1/projects/badgerodon-prod/global/instanceTemplates/consul-00f61c26eaceef6d5cc82adcd2",
                            "service_account.#": "1",
                            "service_account.0.email": "",
                            "service_account.0.scopes.#": "1",
                            "service_account.0.scopes.0": "https://www.googleapis.com/auth/compute.readonly",
                            "tags.#": "2",
                            "tags.3217214002": "consul",
                            "tags.4115889840": "nomad",
                            "tags_fingerprint": ""
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "google_compute_instance_template.worker": {
                    "type": "google_compute_instance_template",
                    "depends_on": [],
                    "primary": {
                        "id": "consul-00f61c26eaceef6d5cc82adcd1",
                        "attributes": {
                            "automatic_restart": "true",
                            "can_ip_forward": "false",
                            "description": "",
                            "disk.#": "1",
                            "disk.0.auto_delete": "true",
                            "disk.0.boot": "true",
                            "disk.0.device_name": "",
                            "disk.0.disk_name": "",
                            "disk.0.disk_size_gb": "0",
                            "disk.0.disk_type": "pd-standard",
                            "disk.0.interface": "SCSI",
                            "disk.0.mode": "READ_WRITE",
                            "disk.0.source": "",
                            "disk.0.source_image": "ubuntu-os-cloud/ubuntu-1704",
                            "disk.0.type": "PERSISTENT",
                            "id": "consul-00f61c26eaceef6d5cc82adcd1",
                            "instance_description": "",
                            "machine_type": "f1-micro",
                            "metadata.%": "0",
                            "metadata_fingerprint": "LGSy1z4UzjM=",
                            "metadata_startup_script": "#!/bin/bash\nset -x\nset -euo pipefail\nIFS=$'\\n\\t'\n#!/bin/bash\n\nif [[ $EUID -ne 0 ]]; then\n  echo \"This script must be run as root\"\n  exit 1\nfi\n\napt-get install -y \\\n    unzip \\\n    apt-transport-https \\\n    ca-certificates \\\n    curl \\\n    software-properties-common\n\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -\n\nsudo add-apt-repository -y \\\n   \"deb [arch=amd64] https://download.docker.com/linux/ubuntu \\\n   $(lsb_release -cs) \\\n   stable\"\n\nsudo apt-get update -y\nsudo apt-get install -y docker-ce\n\n# install docker-credential-gcr\ncurl -L https://github.com/GoogleCloudPlatform/docker-credential-gcr/releases/download/v1.4.1/docker-credential-gcr_linux_amd64-1.4.1.tar.gz | tar -xz -C /usr/local/bin\ndocker-credential-gcr configure-docker\n\n#!/bin/bash\n\nexport CONSUL_VERSION=0.8.5\n\necho \"[install] installing consul\"\ncd /tmp || exit\ncurl -O -L https://releases.hashicorp.com/consul/$CONSUL_VERSION/consul_${CONSUL_VERSION}_linux_amd64.zip\nunzip consul_${CONSUL_VERSION}_linux_amd64.zip\nmv consul /usr/bin/consul\nrm consul_${CONSUL_VERSION}_linux_amd64.zip\n\ncat \u003c\u003cEOF \u003e /etc/systemd/system/consul.service\n[Unit]\nDescription=consul\n[Service]\nExecStart=/usr/bin/consul agent \\\n  -data-dir=\"/tmp/consul\" \\\n  -bind=\"$(ip -o -4 addr show | grep -v docker | grep global | awk -F '[ /]+' '{print $4}')\" \\\n  -retry-join-gce-tag-value consul\nRestart=always\n[Install]\nWantedBy=multi-user.target\nEOF\n\necho \"[install] starting consul\"\nsystemctl daemon-reload\nsystemctl enable consul\nsystemctl start consul\n\ncat \u003c\u003cEOF \u003e /etc/dhcp/dhclient.conf\nprepend domain-name-servers 127.0.0.1;\nEOF\n\n#!/bin/bash\n\nexport NOMAD_VERSION=0.5.6\n\necho \"[install] installing nomad\"\ncd /tmp || exit\ncurl -O -L https://releases.hashicorp.com/nomad/${NOMAD_VERSION}/nomad_${NOMAD_VERSION}_linux_amd64.zip\nunzip nomad_${NOMAD_VERSION}_linux_amd64.zip\nmv nomad /usr/bin/nomad\nrm nomad_${NOMAD_VERSION}_linux_amd64.zip\n\nmkdir -p /etc/nomad\nmkdir -p /tmp/nomad\ncat \u003c\u003cEOF \u003e /etc/nomad/server.hcl\ndata_dir  = \"/tmp/nomad\"\nclient {\n  enabled = true\n}\nEOF\n\ncat \u003c\u003cEOF \u003e /etc/systemd/system/nomad.service\n[Unit]\nDescription=Nomad\nDocumentation=https://nomadproject.io/docs/\n[Service]\nExecStart=/usr/bin/nomad agent -config /etc/nomad\nExecReload=/bin/kill -HUP \\$MAINPID\nLimitNOFILE=65536\n[Install]\nWantedBy=multi-user.target\nEOF\n\necho \"[install] starting nomad\"\nsystemctl daemon-reload\nsystemctl enable nomad\nsystemctl start nomad\n\n  ",
                            "name": "consul-00f61c26eaceef6d5cc82adcd1",
                            "name_prefix": "consul-",
                            "network_interface.#": "1",
                            "network_interface.0.access_config.#": "1",
                            "network_interface.0.access_config.0.nat_ip": "",
                            "network_interface.0.network": "default",
                            "network_interface.0.network_ip": "",
                            "network_interface.0.subnetwork": "",
                            "network_interface.0.subnetwork_project": "",
                            "project": "badgerodon-prod",
                            "region": "us-central1",
                            "scheduling.#": "1",
                            "scheduling.0.automatic_restart": "true",
                            "scheduling.0.on_host_maintenance": "MIGRATE",
                            "scheduling.0.preemptible": "false",
                            "self_link": "https://www.googleapis.com/compute/v1/projects/badgerodon-prod/global/instanceTemplates/consul-00f61c26eaceef6d5cc82adcd1",
                            "service_account.#": "1",
                            "service_account.0.email": "",
                            "service_account.0.scopes.#": "2",
                            "service_account.0.scopes.0": "https://www.googleapis.com/auth/compute.readonly",
                            "service_account.0.scopes.1": "https://www.googleapis.com/auth/devstorage.read_write",
                            "tags.#": "1",
                            "tags.2679291746": "worker",
                            "tags_fingerprint": ""
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                }
            },
            "depends_on": []
        }
    ]
}
